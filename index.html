<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Game Melhorado</title>

<style>
body{
    margin:0;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    background:#111;
    font-family:Arial;
    color:white;
    flex-direction:column;
}

#gameContainer{
    width:60vw;
    max-width:600px;
    text-align:center;
}

canvas{
    background:black;
    width:100%;
    display:none;
    border:3px solid #00ff88;
}

button{
    padding:10px 20px;
    font-size:18px;
    cursor:pointer;
    border:none;
    border-radius:6px;
    background:#00ff88;
    font-weight:bold;
    margin:5px;
}

#gameOver{
    display:none;
    font-size:28px;
    margin-bottom:10px;
    color:red;
}

#scoreBoard{
    margin:10px 0;
}

.controls{
    display:none;
    margin-top:10px;
}

.controls button{
    width:60px;
    height:60px;
    font-size:20px;
}
</style>
</head>
<body>

<div id="gameContainer">
    <div id="gameOver">GAME OVER</div>
    <div id="scoreBoard">
        Pontuação: <span id="score">0</span> |
        Recorde: <span id="highScore">0</span>
    </div>
    <button id="startBtn">Iniciar</button>
    <canvas id="gameCanvas" width="600" height="600"></canvas>

    <div class="controls">
        <div>
            <button onclick="setDirection('UP')">⬆</button>
        </div>
        <div>
            <button onclick="setDirection('LEFT')">⬅</button>
            <button onclick="setDirection('DOWN')">⬇</button>
            <button onclick="setDirection('RIGHT')">➡</button>
        </div>
    </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");
const gameOverText = document.getElementById("gameOver");
const scoreText = document.getElementById("score");
const highScoreText = document.getElementById("highScore");
const controls = document.querySelector(".controls");

const eatSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
const gameOverSound = new Audio("https://actions.google.com/sounds/v1/cartoon/boing.ogg");

const box = 20;
let snake, direction, food, game;
let speed = 120;
let score = 0;
let highScore = localStorage.getItem("snakeHighScore") || 0;
highScoreText.innerText = highScore;

function initGame(){
    snake = [{x: 10*box, y: 10*box}];
    direction = null;
    speed = 120;
    score = 0;
    scoreText.innerText = score;
    food = randomFood();
}

function randomFood(){
    return {
        x: Math.floor(Math.random()*30)*box,
        y: Math.floor(Math.random()*30)*box
    };
}

document.addEventListener("keydown", e => {
    if(e.key === "ArrowLeft") setDirection("LEFT");
    if(e.key === "ArrowUp") setDirection("UP");
    if(e.key === "ArrowRight") setDirection("RIGHT");
    if(e.key === "ArrowDown") setDirection("DOWN");
});

function setDirection(newDir){
    if(newDir === "LEFT" && direction !== "RIGHT") direction = "LEFT";
    if(newDir === "UP" && direction !== "DOWN") direction = "UP";
    if(newDir === "RIGHT" && direction !== "LEFT") direction = "RIGHT";
    if(newDir === "DOWN" && direction !== "UP") direction = "DOWN";
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    snake.forEach((part,i)=>{
        ctx.fillStyle = i===0 ? "#00ff88" : "#00aa55";
        ctx.fillRect(part.x, part.y, box, box);
    });

    ctx.fillStyle = "red";
    ctx.fillRect(food.x, food.y, box, box);

    let headX = snake[0].x;
    let headY = snake[0].y;

    if(direction === "LEFT") headX -= box;
    if(direction === "UP") headY -= box;
    if(direction === "RIGHT") headX += box;
    if(direction === "DOWN") headY += box;

    if(headX === food.x && headY === food.y){
        score++;
        scoreText.innerText = score;
        eatSound.play();
        food = randomFood();

        if(score % 5 === 0 && speed > 50){
            speed -= 10;
            clearInterval(game);
            game = setInterval(draw, speed);
        }
    } else {
        snake.pop();
    }

    let newHead = {x: headX, y: headY};

    if(headX < 0 || headY < 0 || 
       headX >= canvas.width || 
       headY >= canvas.height || 
       collision(newHead, snake)){
        endGame();
        return;
    }

    snake.unshift(newHead);
}

function collision(head,array){
    return array.some(part => part.x===head.x && part.y===head.y);
}

function startGame(){
    startBtn.style.display = "none";
    gameOverText.style.display = "none";
    canvas.style.display = "block";
    controls.style.display = "block";

    initGame();
    clearInterval(game);
    game = setInterval(draw, speed);
}

function endGame(){
    clearInterval(game);
    gameOverSound.play();

    if(score > highScore){
        highScore = score;
        localStorage.setItem("snakeHighScore", highScore);
        highScoreText.innerText = highScore;
    }

    canvas.style.display = "none";
    controls.style.display = "none";
    gameOverText.style.display = "block";
    startBtn.style.display = "inline-block";
}

startBtn.addEventListener("click", startGame);
</script>

</body>
</html>
