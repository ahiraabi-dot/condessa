<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Condessa IPTV - Assinatura</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        /* SEU CSS EXISTENTE PERMANECE EXATAMENTE O MESMO */
        :root {
            --primary-bg: #121212;
            --secondary-bg: #1e1e1e;
            --card-bg: #252525;
            --accent-red: #e50914;
            --accent-yellow: #f5c518;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-primary);
        }

        /* TODO O RESTANTE DO SEU CSS PERMANECE EXATAMENTE IGUAL */
        /* ... */

    </style>
</head>
<body>
    <!-- TODOS OS SEUS ELEMENTOS HTML PERMANECEM EXATAMENTE OS MESMOS -->
    <!-- Tela de Login -->
    <div id="login-overlay" class="login-overlay">
        <!-- ... -->
    </div>

    <!-- Tela de Cadastro -->
    <div id="register-overlay" class="login-overlay hidden">
        <!-- ... -->
    </div>

    <!-- Tela de Login Admin -->
    <div id="admin-login-overlay" class="login-overlay hidden">
        <!-- ... -->
    </div>

    <!-- Dashboard Admin -->
    <div id="dashboard-overlay" class="dashboard-overlay hidden">
        <!-- ... -->
    </div>

    <!-- Aplica√ß√£o Principal -->
    <div id="main-app" class="hidden">
        <!-- ... -->
    </div>

    <script>
        // üî• CONFIGURA√á√ÉO DO FIREBASE (ATUALIZADA COM FIRESTORE)
        const firebaseConfig = {
            apiKey: "AIzaSyCWS0jcIeAySuIaDSBqSe5MtQjDzfmfUsY",
            authDomain: "condessa-c150b.firebaseapp.com",
            projectId: "condessa-c150b",
            storageBucket: "condessa-c150b.firebasestorage.app",
            messagingSenderId: "563703688633",
            appId: "1:563703688633:web:5c6d0db4e50a17341e5a68"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore(); // ‚Üê LINHA ADICIONADA

        // üîê **SISTEMA DE AUTENTICA√á√ÉO ATUALIZADO**
        const ADMIN_CREDENTIALS = { username: '123', password: '123' };
        let currentUser = null;
        let isAdmin = false;

        // üé¨ **SISTEMA DE CONTE√öDO**
        let contentData = JSON.parse(localStorage.getItem('condessa_content')) || {
            movies: [],
            series: [],
            channels: []
        };

        // üë• **SISTEMA DE USU√ÅRIOS ATUALIZADO**
        let usersLocalData = JSON.parse(localStorage.getItem('condessa_users_local')) || {};

        // üóÑÔ∏è **SISTEMA DE SINCRONIZA√á√ÉO COM FIRESTORE**
        
        // Salvar conte√∫do no Firestore
        async function saveContentToFirestore() {
            try {
                await db.collection('content').doc('global').set({
                    movies: contentData.movies,
                    series: contentData.series,
                    channels: contentData.channels,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('‚úÖ Conte√∫do salvo no Firestore');
            } catch (error) {
                console.error('‚ùå Erro ao salvar no Firestore:', error);
            }
        }

        // Carregar conte√∫do do Firestore
        async function loadContentFromFirestore() {
            try {
                const doc = await db.collection('content').doc('global').get();
                if (doc.exists) {
                    const data = doc.data();
                    contentData.movies = data.movies || [];
                    contentData.series = data.series || [];
                    contentData.channels = data.channels || [];
                    localStorage.setItem('condessa_content', JSON.stringify(contentData));
                    console.log('‚úÖ Conte√∫do carregado do Firestore');
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar do Firestore:', error);
                // Fallback para localStorage
                const localData = localStorage.getItem('condessa_content');
                if (localData) {
                    contentData = JSON.parse(localData);
                }
            }
        }

        // Sincronizar usu√°rios com Firestore
        async function syncUsersToFirestore() {
            try {
                await db.collection('users').doc('allUsers').set({
                    users: usersLocalData,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('‚úÖ Usu√°rios sincronizados com Firestore');
            } catch (error) {
                console.error('‚ùå Erro ao sincronizar usu√°rios:', error);
            }
        }

        // Carregar usu√°rios do Firestore
        async function loadUsersFromFirestore() {
            try {
                const doc = await db.collection('users').doc('allUsers').get();
                if (doc.exists) {
                    const data = doc.data();
                    usersLocalData = data.users || {};
                    localStorage.setItem('condessa_users_local', JSON.stringify(usersLocalData));
                    console.log('‚úÖ Usu√°rios carregados do Firestore');
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar usu√°rios:', error);
                // Fallback para localStorage
                const localData = localStorage.getItem('condessa_users_local');
                if (localData) {
                    usersLocalData = JSON.parse(localData);
                }
            }
        }

        // üîÑ **SINCRONIZA√á√ÉO EM TEMPO REAL**
        function setupRealtimeSync() {
            // Ouvir mudan√ßas no conte√∫do
            db.collection('content').doc('global')
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        contentData.movies = data.movies || [];
                        contentData.series = data.series || [];
                        contentData.channels = data.channels || [];
                        localStorage.setItem('condessa_content', JSON.stringify(contentData));
                        
                        // Atualizar a interface se necess√°rio
                        if (!document.getElementById('main-app').classList.contains('hidden')) {
                            loadHomeContent();
                            if (currentTab === 'movies') loadAllMovies();
                            if (currentTab === 'series') loadAllSeries();
                            if (currentTab === 'live') loadAllChannels();
                        }
                    }
                });

            // Ouvir mudan√ßas nos usu√°rios
            db.collection('users').doc('allUsers')
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        usersLocalData = data.users || {};
                        localStorage.setItem('condessa_users_local', JSON.stringify(usersLocalData));
                        updateDashboard();
                        if (document.getElementById('admin-users') && !document.getElementById('admin-users').classList.contains('hidden')) {
                            loadUserList();
                        }
                    }
                });
        }

        // üîß **FUN√á√ïES DO PAINEL ADMIN ATUALIZADAS**

        function switchAdminTab(tabName) {
            document.querySelectorAll('.admin-tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            document.querySelectorAll('.dashboard-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(`admin-${tabName}`).classList.remove('hidden');
            
            document.querySelector(`[onclick="switchAdminTab('${tabName}')"]`).classList.add('active');
            
            if (tabName === 'users') loadUserList();
            if (tabName === 'movies') loadMoviesList();
            if (tabName === 'series') {
                loadSeriesList();
                initializeSeriesForm();
            }
            if (tabName === 'tv') loadChannelsList();
        }

        // üë• **GERENCIAMENTO DE USU√ÅRIOS ATUALIZADO**

        async function addNewUser() {
            const email = document.getElementById('new-username').value;
            const password = document.getElementById('new-password').value;
            const plan = document.getElementById('new-user-plan').value;
            const status = document.getElementById('new-user-status').value;

            if (!email || !password) {
                alert('Preencha e-mail e senha');
                return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then(async (userCredential) => {
                    const user = userCredential.user;
                    
                    usersLocalData[user.uid] = {
                        email: email,
                        plan: plan,
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + parseInt(plan) * 24 * 60 * 60 * 1000).toISOString(),
                        status: status,
                        paymentMethod: 'admin',
                        createdBy: 'admin',
                        createdDate: new Date().toISOString()
                    };

                    localStorage.setItem('condessa_users_local', JSON.stringify(usersLocalData));
                    
                    // üî• SINCRONIZAR COM FIRESTORE
                    await syncUsersToFirestore();
                    
                    document.getElementById('new-username').value = '';
                    document.getElementById('new-password').value = '';
                    
                    alert('‚úÖ Usu√°rio adicionado com sucesso!');
                    loadUserList();
                    updateDashboard();
                })
                .catch((error) => {
                    console.error('Erro ao criar usu√°rio:', error);
                    alert('Erro ao criar usu√°rio: ' + error.message);
                });
        }

        function loadUserList() {
            const userList = document.getElementById('user-list');
            userList.innerHTML = '';

            Object.keys(usersLocalData).forEach(userId => {
                const user = usersLocalData[userId];
                const isActive = new Date(user.endDate) > new Date() && user.status === 'active';
                
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                    <div class="user-info">
                        <strong>${user.email}</strong>
                        <div style="font-size: 0.8rem; color: ${isActive ? '#4CAF50' : '#f44336'}">
                            ${isActive ? '‚úÖ Ativo' : '‚ùå ' + user.status} 
                            - Plano: ${user.plan} dias - Expira: ${new Date(user.endDate).toLocaleDateString()}
                        </div>
                        <div style="font-size: 0.7rem; color: var(--text-secondary)">
                            ID: ${userId}
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="action-btn btn-activate" onclick="activateUser('${userId}')">
                            ${isActive ? 'Desativar' : 'Ativar'}
                        </button>
                        <button class="action-btn btn-edit" onclick="editUser('${userId}')">Editar</button>
                        <button class="action-btn btn-delete" onclick="deleteUser('${userId}')">Excluir</button>
                    </div>
                `;
                
                userList.appendChild(userItem);
            });
        }

        async function activateUser(userId) {
            const user = usersLocalData[userId];
            if (user.status === 'active') {
                user.status = 'expired';
            } else {
                user.status = 'active';
                user.startDate = new Date().toISOString();
                const planDays = parseInt(user.plan);
                user.endDate = new Date(Date.now() + planDays * 24 * 60 * 60 * 1000).toISOString();
            }
            
            localStorage.setItem('condessa_users_local', JSON.stringify(usersLocalData));
            
            // üî• SINCRONIZAR COM FIRESTORE
            await syncUsersToFirestore();
            
            loadUserList();
            updateDashboard();
        }

        async function editUser(userId) {
            const user = usersLocalData[userId];
            const newPlan = prompt('Novo plano para ' + user.email + ' (dias):', user.plan);
            if (newPlan !== null && !isNaN(newPlan)) {
                user.plan = newPlan;
                const planDays = parseInt(newPlan);
                user.endDate = new Date(Date.now() + planDays * 24 * 60 * 60 * 1000).toISOString();
                localStorage.setItem('condessa_users_local', JSON.stringify(usersLocalData));
                
                // üî• SINCRONIZAR COM FIRESTORE
                await syncUsersToFirestore();
                
                alert('Plano atualizado!');
                loadUserList();
            }
        }

        async function deleteUser(userId) {
            if (confirm(`Excluir usu√°rio ${usersLocalData[userId].email}?`)) {
                delete usersLocalData[userId];
                localStorage.setItem('condessa_users_local', JSON.stringify(usersLocalData));
                
                // üî• SINCRONIZAR COM FIRESTORE
                await syncUsersToFirestore();
                
                loadUserList();
                updateDashboard();
                alert('Usu√°rio removido dos dados locais. Para remover completamente, use o Firebase Console.');
            }
        }

        // üé¨ **GERENCIAMENTO DE FILMES ATUALIZADO**

        async function addNewMovie() {
            const movie = {
                id: Date.now(),
                title: document.getElementById('movie-title').value,
                genre: document.getElementById('movie-genre').value,
                rating: parseFloat(document.getElementById('movie-rating').value) || 0,
                image: document.getElementById('movie-image').value || 'https://via.placeholder.com/300x450/333333/FFFFFF?text=Filme',
                videoUrl: document.getElementById('movie-video').value || 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',
                description: document.getElementById('movie-description').value,
                type: 'movie',
                addedDate: new Date().toISOString()
            };

            if (!movie.title) {
                alert('Preencha pelo menos o t√≠tulo do filme');
                return;
            }

            contentData.movies.push(movie);
            localStorage.setItem('condessa_content', JSON.stringify(contentData));
            
            // üî• SALVAR NO FIRESTORE
            await saveContentToFirestore();
            
            document.getElementById('movie-title').value = '';
            document.getElementById('movie-genre').value = '';
            document.getElementById('movie-rating').value = '';
            document.getElementById('movie-image').value = '';
            document.getElementById('movie-video').value = '';
            document.getElementById('movie-description').value = '';
            
            alert('‚úÖ Filme adicionado com sucesso!');
            loadMoviesList();
            updateDashboard();
        }

        function loadMoviesList() {
            const moviesList = document.getElementById('movies-list');
            moviesList.innerHTML = '';

            contentData.movies.forEach(movie => {
                const isYouTube = isYouTubeUrl(movie.videoUrl);
                const youtubeBadge = isYouTube ? '<span class="youtube-badge">YouTube</span>' : '';
                
                const movieItem = document.createElement('div');
                movieItem.className = 'content-item';
                movieItem.innerHTML = `
                    <div class="content-info">
                        <strong>${movie.title} ${youtubeBadge}</strong>
                        <div style="font-size: 0.8rem; color: var(--text-secondary)">
                            ${movie.genre} ‚Ä¢ ‚≠ê ${movie.rating} ‚Ä¢ ${new Date(movie.addedDate).toLocaleDateString()}
                        </div>
                        <div style="font-size: 0.7rem; margin-top: 0.3rem;">
                            ${movie.description || 'Sem descri√ß√£o'}
                        </div>
                    </div>
                    <div class="content-actions">
                        <button class="action-btn btn-edit" onclick="editMovie(${movie.id})">Editar</button>
                        <button class="action-btn btn-delete" onclick="deleteMovie(${movie.id})">Excluir</button>
                    </div>
                `;
                
                moviesList.appendChild(movieItem);
            });
        }

        async function editMovie(movieId) {
            const movie = contentData.movies.find(m => m.id === movieId);
            if (!movie) {
                alert('Filme n√£o encontrado');
                return;
            }

            const newTitle = prompt('Novo t√≠tulo:', movie.title);
            if (newTitle === null) return;

            const newGenre = prompt('Novo g√™nero:', movie.genre);
            if (newGenre === null) return;

            const newRating = prompt('Nova avalia√ß√£o (0-10):', movie.rating);
            if (newRating === null) return;

            const newImage = prompt('Nova URL da imagem:', movie.image);
            if (newImage === null) return;

            const newVideo = prompt('Nova URL do v√≠deo:', movie.videoUrl);
            if (newVideo === null) return;

            const newDescription = prompt('Nova descri√ß√£o:', movie.description);
            if (newDescription === null) return;

            movie.title = newTitle || movie.title;
            movie.genre = newGenre || movie.genre;
            movie.rating = parseFloat(newRating) || movie.rating;
            movie.image = newImage || movie.image;
            movie.videoUrl = newVideo || movie.videoUrl;
            movie.description = newDescription || movie.description;

            localStorage.setItem('condessa_content', JSON.stringify(contentData));
            
            // üî• SALVAR NO FIRESTORE
            await saveContentToFirestore();
            
            loadMoviesList();
            alert('‚úÖ Filme atualizado com sucesso!');
        }

        async function deleteMovie(movieId) {
            if (confirm('Excluir este filme?')) {
                contentData.movies = contentData.movies.filter(movie => movie.id !== movieId);
                localStorage.setItem('condessa_content', JSON.stringify(contentData));
                
                // üî• SALVAR NO FIRESTORE
                await saveContentToFirestore();
                
                loadMoviesList();
                updateDashboard();
            }
        }

        // üì∫ **GERENCIAMENTO DE S√âRIES COM TEMPORADAS E EPIS√ìDIOS ATUALIZADO**

        let seasonCounter = 1;
        let episodeCounters = {};

        function initializeSeriesForm() {
            const seasonsContainer = document.getElementById('seasons-container');
            seasonsContainer.innerHTML = '';
            seasonCounter = 1;
            episodeCounters = {};
            addSeason();
        }

        function addSeason() {
            const seasonsContainer = document.getElementById('seasons-container');
            const seasonId = seasonCounter;
            
            const seasonDiv = document.createElement('div');
            seasonDiv.className = 'season-section';
            seasonDiv.style.border = '1px solid #333';
            seasonDiv.style.padding = '1rem';
            seasonDiv.style.marginBottom = '1rem';
            seasonDiv.style.borderRadius = '6px';
            
            seasonDiv.innerHTML = `
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                    <h4>Temporada ${seasonCounter}</h4>
                    <button type="button" class="action-btn btn-delete" onclick="removeSeason(${seasonId})" style="margin-left: auto;">
                        Remover Temporada
                    </button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">N√∫mero da Temporada</label>
                        <input type="number" class="form-input season-number" value="${seasonCounter}" min="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">T√≠tulo da Temporada (opcional)</label>
                        <input type="text" class="form-input season-title" placeholder="Ex: A Nova Amea√ßa">
                    </div>
                </div>
                <div id="episodes-container-${seasonId}" class="episodes-container">
                    <!-- Epis√≥dios ser√£o adicionados aqui -->
                </div>
                <button type="button" class="submit-btn" onclick="addEpisode(${seasonId})" style="background: #4CAF50; margin-top: 1rem;">
                    + Adicionar Epis√≥dio
                </button>
            `;
            
            seasonsContainer.appendChild(seasonDiv);
            episodeCounters[seasonId] = 1;
            addEpisode(seasonId);
            seasonCounter++;
        }

        function removeSeason(seasonId) {
            const seasonDiv = document.querySelector(`#seasons-container .season-section:nth-child(${seasonId})`);
            if (seasonDiv) {
                seasonDiv.remove();
            }
        }

        function addEpisode(seasonId) {
            const episodesContainer = document.getElementById(`episodes-container-${seasonId}`);
            const episodeNumber = episodeCounters[seasonId];
            
            const episodeDiv = document.createElement('div');
            episodeDiv.className = 'episode-item';
            episodeDiv.style.border = '1px solid #444';
            episodeDiv.style.padding = '1rem';
            episodeDiv.style.marginBottom = '0.5rem';
            episodeDiv.style.borderRadius = '4px';
            
            episodeDiv.innerHTML = `
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 0.5rem;">
                    <h5>Epis√≥dio ${episodeNumber}</h5>
                    <button type="button" class="action-btn btn-delete" onclick="this.parentElement.parentElement.remove()" style="margin-left: auto; padding: 0.3rem 0.6rem; font-size: 0.7rem;">
                        Remover
                    </button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">N√∫mero do Epis√≥dio</label>
                        <input type="number" class="form-input episode-number" value="${episodeNumber}" min="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">T√≠tulo do Epis√≥dio</label>
                        <input type="text" class="form-input episode-title" placeholder="T√≠tulo do epis√≥dio">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dura√ß√£o (minutos)</label>
                        <input type="number" class="form-input episode-duration" placeholder="60">
                    </div>
                    <div class="form-group">
                        <label class="form-label">URL do V√≠deo</label>
                        <input type="text" class="form-input episode-video" placeholder="https://... (YouTube ou v√≠deo direto)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descri√ß√£o</label>
                        <textarea class="form-textarea episode-description" placeholder="Descri√ß√£o do epis√≥dio"></textarea>
                    </div>
                </div>
            `;
            
            episodesContainer.appendChild(episodeDiv);
            episodeCounters[seasonId]++;
        }

        async function addNewSeries() {
            const seriesTitle = document.getElementById('series-title').value;
            const seriesGenre = document.getElementById('series-genre').value;
            const seriesRating = parseFloat(document.getElementById('series-rating').value) || 0;
            const seriesImage = document.getElementById('series-image').value || 'https://via.placeholder.com/300x450/333333/FFFFFF?text=S√©rie';
            const seriesDescription = document.getElementById('series-description').value;

            if (!seriesTitle) {
                alert('Preencha pelo menos o t√≠tulo da s√©rie');
                return;
            }

            const seasons = [];
            const seasonSections = document.querySelectorAll('.season-section');
            
            seasonSections.forEach((seasonSection, index) => {
                const seasonNumber = parseInt(seasonSection.querySelector('.season-number').value) || (index + 1);
                const seasonTitle = seasonSection.querySelector('.season-title').value || `Temporada ${seasonNumber}`;
                
                const episodes = [];
                const episodeItems = seasonSection.querySelectorAll('.episode-item');
                
                episodeItems.forEach((episodeItem, epIndex) => {
                    const episodeNumber = parseInt(episodeItem.querySelector('.episode-number').value) || (epIndex + 1);
                    const episodeTitle = episodeItem.querySelector('.episode-title').value || `Epis√≥dio ${episodeNumber}`;
                    const episodeDuration = parseInt(episodeItem.querySelector('.episode-duration').value) || 0;
                    const episodeVideo = episodeItem.querySelector('.episode-video').value || 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8';
                    const episodeDescription = episodeItem.querySelector('.episode-description').value || '';
                    
                    episodes.push({
                        number: episodeNumber,
                        title: episodeTitle,
                        duration: episodeDuration,
                        videoUrl: episodeVideo,
                        description: episodeDescription
                    });
                });

                seasons.push({
                    number: seasonNumber,
                    title: seasonTitle,
                    episodes: episodes
                });
            });

            const series = {
                id: Date.now(),
                title: seriesTitle,
                genre: seriesGenre,
                rating: seriesRating,
                image: seriesImage,
                description: seriesDescription,
                seasons: seasons,
                type: 'series',
                addedDate: new Date().toISOString()
            };

            contentData.series.push(series);
            localStorage.setItem('condessa_content', JSON.stringify(contentData));
            
            // üî• SALVAR NO FIRESTORE
            await saveContentToFirestore();
            
            document.getElementById('series-title').value = '';
            document.getElementById('series-genre').value = '';
            document.getElementById('series-rating').value = '';
            document.getElementById('series-image').value = '';
            document.getElementById('series-description').value = '';
            initializeSeriesForm();
            
            alert('‚úÖ S√©rie adicionada com sucesso!');
            loadSeriesList();
            updateDashboard();
        }

        function loadSeriesList() {
            const seriesList = document.getElementById('series-list');
            seriesList.innerHTML = '';

            contentData.series.forEach(series => {
                const totalSeasons = series.seasons.length;
                const totalEpisodes = series.seasons.reduce((total, season) => total + season.episodes.length, 0);
                
                const seriesItem = document.createElement('div');
                seriesItem.className = 'content-item';
                seriesItem.innerHTML = `
                    <div class="content-info">
                        <strong>${series.title}</strong>
                        <div style="font-size: 0.8rem; color: var(--text-secondary)">
                            ${series.genre} ‚Ä¢ ‚≠ê ${series.rating} ‚Ä¢ ${totalSeasons} temporadas ‚Ä¢ ${totalEpisodes} epis√≥dios
                        </div>
                        <div style="font-size: 0.7rem; margin-top: 0.3rem;">
                            ${series.description || 'Sem descri√ß√£o'}
                        </div>
                    </div>
                    <div class="content-actions">
                        <button class="action-btn btn-edit" onclick="editSeries(${series.id})">Editar</button>
                        <button class="action-btn btn-delete" onclick="deleteSeries(${series.id})">Excluir</button>
                    </div>
                `;
                
                seriesList.appendChild(seriesItem);
            });
        }

        async function editSeries(seriesId) {
            const series = contentData.series.find(s => s.id === seriesId);
            if (!series) {
                alert('S√©rie n√£o encontrada');
                return;
            }

            const newTitle = prompt('Novo t√≠tulo:', series.title);
            if (newTitle === null) return;

            const newGenre = prompt('Novo g√™nero:', series.genre);
            if (newGenre === null) return;

            const newRating = prompt('Nova avalia√ß√£o (0-10):', series.rating);
            if (newRating === null) return;

            const newImage = prompt('Nova URL da imagem:', series.image);
            if (newImage === null) return;

            const newDescription = prompt('Nova descri√ß√£o:', series.description);
            if (newDescription === null) return;

            series.title = newTitle || series.title;
            series.genre = newGenre || series.genre;
            series.rating = parseFloat(newRating) || series.rating;
            series.image = newImage || series.image;
            series.description = newDescription || series.description;

            localStorage.setItem('condessa_content', JSON.stringify(contentData));
            
            // üî• SALVAR NO FIRESTORE
            await saveContentToFirestore();
            
            loadSeriesList();
            alert('‚úÖ S√©rie atualizado com sucesso!');
        }

        async function deleteSeries(seriesId) {
            if (confirm('Excluir esta s√©rie?')) {
                contentData.series = contentData.series.filter(series => series.id !== seriesId);
                localStorage.setItem('condessa_content', JSON.stringify(contentData));
                
                // üî• SALVAR NO FIRESTORE
                await saveContentToFirestore();
                
                loadSeriesList();
                updateDashboard();
            }
        }

        // üì° **GERENCIAMENTO DE CANAIS TV ATUALIZADO**

        async function addNewChannel() {
            const channel = {
                id: Date.now(),
                title: document.getElementById('channel-name').value,
                genre: document.getElementById('channel-category').value,
                rating: parseFloat(document.getElementById('channel-rating').value) || 0,
                image: document.getElementById('channel-logo').value || 'https://via.placeholder.com/300x200/333333/FFFFFF?text=Canal',
                videoUrl: document.getElementById('channel-stream').value || 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',
                country: document.getElementById('channel-country').value || 'BR',
                type: 'channel',
                addedDate: new Date().toISOString()
            };

            if (!channel.title) {
                alert('Preencha pelo menos o nome do canal');
                return;
            }

            contentData.channels.push(channel);
            localStorage.setItem('condessa_content', JSON.stringify(contentData));
            
            // üî• SALVAR NO FIRESTORE
            await saveContentToFirestore();
            
            document.getElementById('channel-name').value = '';
            document.getElementById('channel-category').value = '';
            document.getElementById('channel-rating').value = '';
            document.getElementById('channel-logo').value = '';
            document.getElementById('channel-stream').value = '';
            document.getElementById('channel-country').value = '';
            
            alert('‚úÖ Canal adicionado com sucesso!');
            loadChannelsList();
            updateDashboard();
        }

        function loadChannelsList() {
            const channelsList = document.getElementById('channels-list');
            channelsList.innerHTML = '';

            contentData.channels.forEach(channel => {
                const isYouTube = isYouTubeUrl(channel.videoUrl);
                const youtubeBadge = isYouTube ? '<span class="youtube-badge">YouTube</span>' : '';
                
                const channelItem = document.createElement('div');
                channelItem.className = 'content-item';
                channelItem.innerHTML = `
                    <div class="content-info">
                        <strong>${channel.title} ${youtubeBadge}</strong>
                        <div style="font-size: 0.8rem; color: var(--text-secondary)">
                            ${channel.genre} ‚Ä¢ ‚≠ê ${channel.rating} ‚Ä¢ ${channel.country} ‚Ä¢ ${new Date(channel.addedDate).toLocaleDateString()}
                        </div>
                    </div>
                    <div class="content-actions">
                        <button class="action-btn btn-edit" onclick="editChannel(${channel.id})">Editar</button>
                        <button class="action-btn btn-delete" onclick="deleteChannel(${channel.id})">Excluir</button>
                    </div>
                `;
                
                channelsList.appendChild(channelItem);
            });
        }

        async function editChannel(channelId) {
            const channel = contentData.channels.find(c => c.id === channelId);
            if (!channel) {
                alert('Canal n√£o encontrado');
                return;
            }

            const newTitle = prompt('Novo nome do canal:', channel.title);
            if (newTitle === null) return;

            const newCategory = prompt('Nova categoria:', channel.genre);
            if (newCategory === null) return;

            const newRating = prompt('Nova avalia√ß√£o (0-5):', channel.rating);
            if (newRating === null) return;

            const newLogo = prompt('Nova URL da logo:', channel.image);
            if (newLogo === null) return;

            const newStream = prompt('Nova URL do stream:', channel.videoUrl);
            if (newStream === null) return;

            const newCountry = prompt('Novo pa√≠s:', channel.country);
            if (newCountry === null) return;

            channel.title = newTitle || channel.title;
            channel.genre = newCategory || channel.genre;
            channel.rating = parseFloat(newRating) || channel.rating;
            channel.image = newLogo || channel.image;
            channel.videoUrl = newStream || channel.videoUrl;
            channel.country = newCountry || channel.country;

            localStorage.setItem('condessa_content', JSON.stringify(contentData));
            
            // üî• SALVAR NO FIRESTORE
            await saveContentToFirestore();
            
            loadChannelsList();
            alert('‚úÖ Canal atualizado com sucesso!');
        }

        async function deleteChannel(channelId) {
            if (confirm('Excluir este canal?')) {
                contentData.channels = contentData.channels.filter(channel => channel.id !== channelId);
                localStorage.setItem('condessa_content', JSON.stringify(contentData));
                
                // üî• SALVAR NO FIRESTORE
                await saveContentToFirestore();
                
                loadChannelsList();
                updateDashboard();
            }
        }

        // üìä **ATUALIZA√á√ÉO DO DASHBOARD ATUALIZADA**

        function updateDashboard() {
            const activeUsers = Object.values(usersLocalData).filter(user => 
                new Date(user.endDate) > new Date() && user.status === 'active'
            ).length;

            const totalUsers = Object.keys(usersLocalData).length;
            const monthlyRevenue = activeUsers * 30;
            const totalContent = contentData.movies.length + contentData.series.length + contentData.channels.length;

            document.getElementById('active-users-count').textContent = activeUsers;
            document.getElementById('total-users').textContent = totalUsers;
            document.getElementById('monthly-revenue').textContent = `R$ ${monthlyRevenue}`;
            document.getElementById('total-content').textContent = totalContent;
        }

        // üîê **FUN√á√ïES DE AUTENTICA√á√ÉO ATUALIZADAS**

        function showUserLogin() {
            document.getElementById('register-overlay').classList.add('hidden');
            document.getElementById('admin-login-overlay').classList.add('hidden');
            document.getElementById('login-overlay').classList.remove('hidden');
        }

        function showRegister() {
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('admin-login-overlay').classList.add('hidden');
            document.getElementById('register-overlay').classList.remove('hidden');
        }

        function showAdminLogin() {
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('register-overlay').classList.add('hidden');
            document.getElementById('admin-login-overlay').classList.remove('hidden');
        }

        async function registerUser() {
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;

            if (!email || !password || !confirmPassword) {
                alert('Por favor, preencha todos os campos');
                return;
            }

            if (password !== confirmPassword) {
                alert('As senhas n√£o coincidem');
                return;
            }

            if (password.length < 6) {
                alert('A senha deve ter pelo menos 6 caracteres');
                return;
            }

            const registerBtn = document.getElementById('register-btn');
            registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cadastrando...';
            registerBtn.disabled = true;

            auth.createUserWithEmailAndPassword(email, password)
                .then(async (userCredential) => {
                    const user = userCredential.user;
                    
                    usersLocalData[user.uid] = {
                        email: email,
                        plan: '7',
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                        status: 'active',
                        paymentMethod: 'none',
                        createdDate: new Date().toISOString()
                    };
                    
                    localStorage.setItem('condessa_users_local', JSON.stringify(usersLocalData));
                    
                    // üî• SINCRONIZAR COM FIRESTORE
                    await syncUsersToFirestore();
                    
                    alert('‚úÖ Cadastro realizado com sucesso! Fa√ßa login para continuar.');
                    showUserLogin();
                })
                .catch((error) => {
                    let errorMessage = 'Erro ao cadastrar: ';
                    switch (error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage += 'Este e-mail j√° est√° em uso.';
                            break;
                        case 'auth/invalid-email':
                            errorMessage += 'E-mail inv√°lido.';
                            break;
                        case 'auth/weak-password':
                            errorMessage += 'Senha muito fraca. Use pelo menos 6 caracteres.';
                            break;
                        default:
                            errorMessage += error.message;
                    }
                    
                    alert(errorMessage);
                })
                .finally(() => {
                    registerBtn.innerHTML = 'Cadastrar';
                    registerBtn.disabled = false;
                });
        }

        function loginUser() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                alert('Por favor, preencha todos os campos');
                return;
            }

            const loginBtn = document.getElementById('login-btn');
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Entrando...';
            loginBtn.disabled = true;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    currentUser = user.uid;
                    
                    if (!usersLocalData[user.uid]) {
                        usersLocalData[user.uid] = {
                            email: email,
                            plan: '7',
                            startDate: new Date().toISOString(),
                            endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                            status: 'active',
                            paymentMethod: 'none',
                            createdDate: new Date().toISOString()
                        };
                        localStorage.setItem('condessa_users_local', JSON.stringify(usersLocalData));
                    }
                    
                    startApplication();
                })
                .catch((error) => {
                    let errorMessage = 'Erro ao fazer login: ';
                    switch (error.code) {
                        case 'auth/user-not-found':
                            errorMessage += 'Usu√°rio n√£o encontrado.';
                            break;
                        case 'auth/wrong-password':
                            errorMessage += 'Senha incorreta.';
                            break;
                        case 'auth/invalid-email':
                            errorMessage += 'E-mail inv√°lido.';
                            break;
                        default:
                            errorMessage += error.message;
                    }
                    
                    alert(errorMessage);
                })
                .finally(() => {
                    loginBtn.innerHTML = 'Entrar';
                    loginBtn.disabled = false;
                });
        }

        function loginAdmin() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;

            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                isAdmin = true;
                showDashboard();
            } else {
                alert('Credenciais administrativas incorretas');
            }
        }

        function logoutUser() {
            auth.signOut().then(() => {
                currentUser = null;
                document.getElementById('main-app').classList.add('hidden');
                document.getElementById('login-overlay').classList.remove('hidden');
                document.getElementById('login-email').value = '';
                document.getElementById('login-password').value = '';
            }).catch((error) => {
                console.error('Erro ao fazer logout:', error);
            });
        }

        function logoutAdmin() {
            isAdmin = false;
            document.getElementById('dashboard-overlay').classList.add('hidden');
            showUserLogin();
        }

        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user.uid;
                if (!document.getElementById('main-app').classList.contains('hidden')) {
                    startApplication();
                }
            } else {
                currentUser = null;
            }
        });

        // üöÄ **FUN√á√ÉO STARTAPPLICATION ATUALIZADA**
        async function startApplication() {
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('register-overlay').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            // üî• CARREGAR DADOS DO FIRESTORE
            await loadContentFromFirestore();
            await loadUsersFromFirestore();
            
            // üî• ATIVAR SINCRONIZA√á√ÉO EM TEMPO REAL
            setupRealtimeSync();
            
            loadHomeContent();
            initializeNavigation();
        }

        function showDashboard() {
            document.getElementById('admin-login-overlay').classList.add('hidden');
            document.getElementById('dashboard-overlay').classList.remove('hidden');
            updateDashboard();
            loadUserList();
            loadMoviesList();
            loadSeriesList();
            loadChannelsList();
        }

        // üé¨ **SISTEMA DE NAVEGA√á√ÉO E CONTE√öDO (PERMANECE O MESMO)**
        let currentTab = 'home';
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let currentSeries = null;

        function initializeNavigation() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function switchTab(tabId) {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function loadTabContent(tabId) {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function loadHomeContent() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function loadAllMovies() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function loadAllSeries() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function loadAllChannels() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function loadContentToGrid(contentType, containerId, limit = null) {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function createContentCard(item) {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function isYouTubeUrl(url) {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function extractYouTubeId(url) {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function openSeriesModal(series) {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function closeSeriesModal() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function loadEpisodes(season) {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function playEpisode(episode) {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function toggleFavorite(contentId, button) {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function loadFavorites() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function getAllContent() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function playContent(item) {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function closeVideoPlayer() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function requireSubscription() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function showSubscriptionModal() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function performSearch() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function showSearchResults(searchTerm) {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        function clearSearch() {
            // ... TODO O C√ìDIGO EXISTENTE PERMANECE EXATAMENTE O MESMO ...
        }

        // üì± **INICIALIZA√á√ÉO**
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('login-btn').addEventListener('click', loginUser);
            document.getElementById('register-btn').addEventListener('click', registerUser);
            document.getElementById('admin-login-btn').addEventListener('click', loginAdmin);

            document.getElementById('login-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') loginUser();
            });
            
            document.getElementById('register-confirm-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') registerUser();
            });

            showUserLogin();
        });

    </script>
</body>
</html>
